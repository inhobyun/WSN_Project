{% extends "m_base.html" %}

{% block left %}
    <p style="text-align:center;"><Strong>Sensor Data Monitoring</Strong><cr></p> 
    <p style="text-align: right; padding-right:8px;"><button id="startBtn" onclick="startMonitoring()"> Start </button></p>
    <p style="text-align: right; padding-right:8px;"><button id="stopBtn"  onclick="stopMonitoring()" disabled> Stop </button></p>

    <p style="position:absolute; left:  8px; top:72px;"><label>Option</label></p>
    <p style="position:absolute; left: 60px; top:72px;"><label>Interval</label></p>
    <p style="position:absolute; left:114px; top:70px; width:30px;"><input type="number" id="tm_period" value="3" min="1" max="5"></p>
    <p style="position:absolute; left:180px; top:72px;"><label>sec</label></p>    
{% endblock %}

{% block foot %}
    <p style="color:aqua;">Display Sensor Data...</p>
{% endblock %}

{% block right %}

<p style="text-align:left;  padding-top:4px; padding-left:8px"><Strong>SCD Sensor Data - on-time display</Strong><cr></p>
<p style="text-align:right; position:absolute; top:70px; left:288px;"><label id="row_00_label">Sensor Measured Time : </label></p>
<p style="text-align:left;  position:absolute; top:70px; left:420px;"><label id="row_00">YYYY-MM-DD hh:mm:ss [unix time]</label></p>

<table id="monitor">
        <tr>
            <th>Sensor</th>
            <th>Value Measured</th>
            <th>Unit of Measure</th>
        </tr>
        <tr>
            <td class="col_00">accelerometer mean X-axis</td>
            <td class="col_01" id="row_01">-</td>
            <td class="col_02" style="text-align:left;">g</td>
        </tr>
        <tr>
            <td class="col_00">accelerometer variance X-axis</td>
            <td class="col_01" id="row_02">-</td>
            <td class="col_02" style="text-align:left;">g**2</td>
        </tr>
        <tr>
            <td class="col_00">accelerometer mean. Y-axis</td>
            <td class="col_01" id="row_03">-</td>
            <td class="col_02" style="text-align:left;">g</td>
        </tr>
        <tr>
            <td class="col_00">accelerometer variance Y-axis</td>
            <td class="col_01" id="row_04">-</td>
            <td class="col_02" style="text-align:left;">g**2</td>
        </tr>
        <tr>
            <td class="col_00">accelerometer mean. Z-axis</td>
            <td class="col_01" id="row_05">-</td>
            <td class="col_02" style="text-align:left;">g</td>
        </tr>
        <tr>
            <td class="col_00">accelerometer variance Z-axis</td>
            <td class="col_01" id="row_06">-</td>
            <td class="col_02" style="text-align:left;">g**2</td>
        </tr>
        <tr>
            <td class="col_00">temperature</td>
            <td class="col_01" id="row_07">-</td>
            <td class="col_02" style="text-align:left;">celcius</td>
        </tr>
        <tr>
            <td class="col_00">light</td>
            <td class="col_01" id="row_08">-</td>
            <td class="col_02" style="text-align:left;">Lux</td>
        </tr>
        <tr>
            <td class="col_00">magnetometer X-axis</td>
            <td class="col_01" id="row_09">-</td>
            <td class="col_02" style="text-align:left;">uT</td>
        </tr>
        <tr>
            <td class="col_00">magnetometer Y-axis</td>
            <td class="col_01" id="row_10">-</td>
            <td class="col_02" style="text-align:left;">uT</td>
        </tr>
        <tr>
            <td class="col_00">magnetometer Z-axis</td>
            <td class="col_01" id="row_11">-</td>
            <td class="col_02" style="text-align:left;">uT</td>
        </tr>
</table>

<script>

    var tid = null

    function dispData(data) {
        document.getElementById("row_00").innerHTML = data.row_00
        document.getElementById("row_01").innerHTML = data.row_01
        document.getElementById("row_02").innerHTML = data.row_02
        document.getElementById("row_03").innerHTML = data.row_03
        document.getElementById("row_04").innerHTML = data.row_04
        document.getElementById("row_05").innerHTML = data.row_05
        document.getElementById("row_06").innerHTML = data.row_06
        document.getElementById("row_07").innerHTML = data.row_07
        document.getElementById("row_08").innerHTML = data.row_08
        document.getElementById("row_09").innerHTML = data.row_09
        document.getElementById("row_10").innerHTML = data.row_10
        document.getElementById("row_11").innerHTML = data.row_11
    }

    function doingMonitoring() {
        const value = document.getElementById('tm_period').value;
        axios.post('/post_monStart', {
            value: Number(value),
        }).then(response => {
            const data = response.data;
            dispData(data);
            //console.log(data);
        }).catch(function (error) {
            alert('Error occurred on submit: ' + error);
        });
        tid = setTimeout(doingMonitoring, Number(value)*1000);
    }
    
    function startMonitoring() {
        document.getElementById("startBtn").disabled = true;
        document.getElementById("stopBtn").disabled = false;
        doingMonitoring();
    }

    function stopMonitoring() {
        document.getElementById("startBtn").disabled = false;
        document.getElementById("stopBtn").disabled = true;
        const value = document.getElementById('tm_period').value;
        clearTimeout ( tid );
        axios.post('/post_monStop', {
            value: Number(value),
        }).then(response => {
            const data = response.data;
            dispData(data);
            //console.log(data);
        }).catch(function (error) {
            alert('Error occurred on submit: ' + error);
        });
    }
</script>

{% endblock %}